// SPDX-License-Identifier: GPL-2.0-or-later
/*
 * Unit tests for the Lab color space
 *
 * Copyright (C) 2023 Authors
 *
 * Released under GNU GPL v2+, read the file 'COPYING' for more information.
 */

#include "colors/spaces/lab.h"
#include "spaces-testbase.h"

namespace {

using Space::Type::LAB;
using Space::Type::RGB;
using Space::Type::XYZ;

// clang-format off
INSTANTIATE_TEST_SUITE_P(ColorsSpacesLAB, fromString, testing::Values(
    // Lab to sRGB taken from Chromium (Linux)
    _P(in, "lab(0% -125 -125)",     { 0.0,  0.011764705882352941, 0.011764705882352941     }, 0x003abeff),
    _P(in, "lab(0% -125 -60)",     { 0.0,  0.011764705882352941, 0.26666666666666666     }, 0x003357ff),
    _P(in, "lab(0% -125 0)",     { 0.0,  0.011764705882352941, 0.5019607843137255     }, 0x003100ff),
    _P(in, "lab(0% -125 60)",     { 0.0,  0.011764705882352941, 0.7372549019607844     }, 0x003000ff),
    _P(in, "lab(0% -125 125)",     { 0.0,  0.011764705882352941, 0.9921568627450981     }, 0x002f00ff),
    _P(in, "lab(0% -60 -125)",     { 0.0,  0.26666666666666666, 0.011764705882352941     }, 0x002ebeff),
    _P(in, "lab(0% -60 -60)",     { 0.0,  0.26666666666666666, 0.26666666666666666     }, 0x002357ff),
    _P(in, "lab(0% -60 0)",     { 0.0,  0.26666666666666666, 0.5019607843137255     }, 0x002000ff),
    _P(in, "lab(0% -60 60)",     { 0.0,  0.26666666666666666, 0.7372549019607844     }, 0x001f00ff),
    _P(in, "lab(0% -60 125)",     { 0.0,  0.26666666666666666, 0.9921568627450981     }, 0x001d00ff),
    _P(in, "lab(0% 0 -125)",     { 0.0,  0.5019607843137255, 0.011764705882352941     }, 0x001dbeff),
    _P(in, "lab(0% 0 -60)",     { 0.0,  0.5019607843137255, 0.26666666666666666     }, 0x000858ff),
    _P(in, "lab(0% 0 0)",     { 0.0,  0.5019607843137255, 0.5019607843137255     }, 0x000000ff),
    _P(in, "lab(0% 0 60)",     { 0.0,  0.5019607843137255, 0.7372549019607844     }, 0x210000ff),
    _P(in, "lab(0% 0 125)",     { 0.0,  0.5019607843137255, 0.9921568627450981     }, 0x320000ff),
    _P(in, "lab(0% 60 -125)",     { 0.0,  0.7372549019607844, 0.011764705882352941     }, 0x0000beff),
    _P(in, "lab(0% 60 -60)",     { 0.0,  0.7372549019607844, 0.26666666666666666     }, 0x240058ff),
    _P(in, "lab(0% 60 0)",     { 0.0,  0.7372549019607844, 0.5019607843137255     }, 0x400004ff),
    _P(in, "lab(0% 60 60)",     { 0.0,  0.7372549019607844, 0.7372549019607844     }, 0x490000ff),
    _P(in, "lab(0% 60 125)",     { 0.0,  0.7372549019607844, 0.9921568627450981     }, 0x520000ff),
    _P(in, "lab(0% 125 -125)",     { 0.0,  0.9921568627450981, 0.011764705882352941     }, 0x0000bfff),
    _P(in, "lab(0% 125 -60)",     { 0.0,  0.9921568627450981, 0.26666666666666666     }, 0x69005aff),
    _P(in, "lab(0% 125 0)",     { 0.0,  0.9921568627450981, 0.5019607843137255     }, 0x75000dff),
    _P(in, "lab(0% 125 60)",     { 0.0,  0.9921568627450981, 0.7372549019607844     }, 0x790000ff),
    _P(in, "lab(0% 125 125)",     { 0.0,  0.9921568627450981, 0.9921568627450981     }, 0x7e0000ff),
    _P(in, "lab(20% -125 -125)",     { 0.2,  0.011764705882352941, 0.011764705882352941     }, 0x0054f8ff),
    _P(in, "lab(20% -125 -60)",     { 0.2,  0.011764705882352941, 0.26666666666666666     }, 0x004c8aff),
    _P(in, "lab(20% -125 0)",     { 0.2,  0.011764705882352941, 0.5019607843137255     }, 0x00492eff),
    _P(in, "lab(20% -125 60)",     { 0.2,  0.011764705882352941, 0.7372549019607844     }, 0x004900ff),
    _P(in, "lab(20% -125 125)",     { 0.2,  0.011764705882352941, 0.9921568627450981     }, 0x004800ff),
    _P(in, "lab(20% -60 -125)",     { 0.2,  0.26666666666666666, 0.011764705882352941     }, 0x004df8ff),
    _P(in, "lab(20% -60 -60)",     { 0.2,  0.26666666666666666, 0.26666666666666666     }, 0x00448bff),
    _P(in, "lab(20% -60 0)",     { 0.2,  0.26666666666666666, 0.5019607843137255     }, 0x00402fff),
    _P(in, "lab(20% -60 60)",     { 0.2,  0.26666666666666666, 0.7372549019607844     }, 0x003f00ff),
    _P(in, "lab(20% -60 125)",     { 0.2,  0.26666666666666666, 0.9921568627450981     }, 0x003f00ff),
    _P(in, "lab(20% 0 -125)",     { 0.2,  0.5019607843137255, 0.011764705882352941     }, 0x0040f9ff),
    _P(in, "lab(20% 0 -60)",     { 0.2,  0.5019607843137255, 0.26666666666666666     }, 0x00358bff),
    _P(in, "lab(20% 0 0)",     { 0.2,  0.5019607843137255, 0.5019607843137255     }, 0x303030ff),
    _P(in, "lab(20% 0 60)",     { 0.2,  0.5019607843137255, 0.7372549019607844     }, 0x3e2f00ff),
    _P(in, "lab(20% 0 125)",     { 0.2,  0.5019607843137255, 0.9921568627450981     }, 0x482e00ff),
    _P(in, "lab(20% 60 -125)",     { 0.2,  0.7372549019607844, 0.011764705882352941     }, 0x000ff9ff),
    _P(in, "lab(20% 60 -60)",     { 0.2,  0.7372549019607844, 0.26666666666666666     }, 0x59008cff),
    _P(in, "lab(20% 60 0)",     { 0.2,  0.7372549019607844, 0.5019607843137255     }, 0x760033ff),
    _P(in, "lab(20% 60 60)",     { 0.2,  0.7372549019607844, 0.7372549019607844     }, 0x7b0000ff),
    _P(in, "lab(20% 60 125)",     { 0.2,  0.7372549019607844, 0.9921568627450981     }, 0x800000ff),
    _P(in, "lab(20% 125 -125)",     { 0.2,  0.9921568627450981, 0.011764705882352941     }, 0x6d00faff),
    _P(in, "lab(20% 125 -60)",     { 0.2,  0.9921568627450981, 0.26666666666666666     }, 0xa8008eff),
    _P(in, "lab(20% 125 0)",     { 0.2,  0.9921568627450981, 0.5019607843137255     }, 0xb70038ff),
    _P(in, "lab(20% 125 60)",     { 0.2,  0.9921568627450981, 0.7372549019607844     }, 0xba0000ff),
    _P(in, "lab(20% 125 125)",     { 0.2,  0.9921568627450981, 0.9921568627450981     }, 0xbd0000ff),
    _P(in, "lab(40% -125 -125)",     { 0.4,  0.011764705882352941, 0.011764705882352941     }, 0x0087ffff),
    _P(in, "lab(40% -125 -60)",     { 0.4,  0.011764705882352941, 0.26666666666666666     }, 0x0080c1ff),
    _P(in, "lab(40% -125 0)",     { 0.4,  0.011764705882352941, 0.5019607843137255     }, 0x007d5bff),
    _P(in, "lab(40% -125 60)",     { 0.4,  0.011764705882352941, 0.7372549019607844     }, 0x007d00ff),
    _P(in, "lab(40% -125 125)",     { 0.4,  0.011764705882352941, 0.9921568627450981     }, 0x007c00ff),
    _P(in, "lab(40% -60 -125)",     { 0.4,  0.26666666666666666, 0.011764705882352941     }, 0x007effff),
    _P(in, "lab(40% -60 -60)",     { 0.4,  0.26666666666666666, 0.26666666666666666     }, 0x0077c1ff),
    _P(in, "lab(40% -60 0)",     { 0.4,  0.26666666666666666, 0.5019607843137255     }, 0x00745cff),
    _P(in, "lab(40% -60 60)",     { 0.4,  0.26666666666666666, 0.7372549019607844     }, 0x007300ff),
    _P(in, "lab(40% -60 125)",     { 0.4,  0.26666666666666666, 0.9921568627450981     }, 0x007200ff),
    _P(in, "lab(40% 0 -125)",     { 0.4,  0.5019607843137255, 0.011764705882352941     }, 0x006bffff),
    _P(in, "lab(40% 0 -60)",     { 0.4,  0.5019607843137255, 0.26666666666666666     }, 0x0062c2ff),
    _P(in, "lab(40% 0 0)",     { 0.4,  0.5019607843137255, 0.5019607843137255     }, 0x5e5e5eff),
    _P(in, "lab(40% 0 60)",     { 0.4,  0.5019607843137255, 0.7372549019607844     }, 0x6e5d00ff),
    _P(in, "lab(40% 0 125)",     { 0.4,  0.5019607843137255, 0.9921568627450981     }, 0x735d00ff),
    _P(in, "lab(40% 60 -125)",     { 0.4,  0.7372549019607844, 0.011764705882352941     }, 0x003dffff),
    _P(in, "lab(40% 60 -60)",     { 0.4,  0.7372549019607844, 0.26666666666666666     }, 0x9229c3ff),
    _P(in, "lab(40% 60 0)",     { 0.4,  0.7372549019607844, 0.5019607843137255     }, 0xb01d61ff),
    _P(in, "lab(40% 60 60)",     { 0.4,  0.7372549019607844, 0.7372549019607844     }, 0xb81800ff),
    _P(in, "lab(40% 60 125)",     { 0.4,  0.7372549019607844, 0.9921568627450981     }, 0xbb1600ff),
    _P(in, "lab(40% 125 -125)",     { 0.4,  0.9921568627450981, 0.011764705882352941     }, 0xb400ffff),
    _P(in, "lab(40% 125 -60)",     { 0.4,  0.9921568627450981, 0.26666666666666666     }, 0xe900c5ff),
    _P(in, "lab(40% 125 0)",     { 0.4,  0.9921568627450981, 0.5019607843137255     }, 0xfb0066ff),
    _P(in, "lab(40% 125 60)",     { 0.4,  0.9921568627450981, 0.7372549019607844     }, 0xff0016ff),
    _P(in, "lab(40% 125 125)",     { 0.4,  0.9921568627450981, 0.9921568627450981     }, 0xff0000ff),
    _P(in, "lab(60% -125 -125)",     { 0.6,  0.011764705882352941, 0.011764705882352941     }, 0x00c1ffff),
    _P(in, "lab(60% -125 -60)",     { 0.6,  0.011764705882352941, 0.26666666666666666     }, 0x00bcf9ff),
    _P(in, "lab(60% -125 0)",     { 0.6,  0.011764705882352941, 0.5019607843137255     }, 0x00b98dff),
    _P(in, "lab(60% -125 60)",     { 0.6,  0.011764705882352941, 0.7372549019607844     }, 0x00b800ff),
    _P(in, "lab(60% -125 125)",     { 0.6,  0.011764705882352941, 0.9921568627450981     }, 0x00b700ff),
    _P(in, "lab(60% -60 -125)",     { 0.6,  0.26666666666666666, 0.011764705882352941     }, 0x00b3ffff),
    _P(in, "lab(60% -60 -60)",     { 0.6,  0.26666666666666666, 0.26666666666666666     }, 0x00adfaff),
    _P(in, "lab(60% -60 0)",     { 0.6,  0.26666666666666666, 0.5019607843137255     }, 0x00aa8eff),
    _P(in, "lab(60% -60 60)",     { 0.6,  0.26666666666666666, 0.7372549019607844     }, 0x00a900ff),
    _P(in, "lab(60% -60 125)",     { 0.6,  0.26666666666666666, 0.9921568627450981     }, 0x1fa800ff),
    _P(in, "lab(60% 0 -125)",     { 0.6,  0.5019607843137255, 0.011764705882352941     }, 0x009cffff),
    _P(in, "lab(60% 0 -60)",     { 0.6,  0.5019607843137255, 0.26666666666666666     }, 0x3a94fbff),
    _P(in, "lab(60% 0 0)",     { 0.6,  0.5019607843137255, 0.5019607843137255     }, 0x919191ff), // 0x909191ff
    _P(in, "lab(60% 0 60)",     { 0.6,  0.5019607843137255, 0.7372549019607844     }, 0xa58f14ff),
    _P(in, "lab(60% 0 125)",     { 0.6,  0.5019607843137255, 0.9921568627450981     }, 0xaa8f00ff),
    _P(in, "lab(60% 60 -125)",     { 0.6,  0.7372549019607844, 0.011764705882352941     }, 0x5b6effff), // 0x5a6effff
    _P(in, "lab(60% 60 -60)",     { 0.6,  0.7372549019607844, 0.26666666666666666     }, 0xcb62fdff),
    _P(in, "lab(60% 60 0)",     { 0.6,  0.7372549019607844, 0.5019607843137255     }, 0xec5c94ff), // 0xec5c93ff
    _P(in, "lab(60% 60 60)",     { 0.6,  0.7372549019607844, 0.7372549019607844     }, 0xf85927ff),
    _P(in, "lab(60% 60 125)",     { 0.6,  0.7372549019607844, 0.9921568627450981     }, 0xfa5900ff),
    _P(in, "lab(60% 125 -125)",     { 0.6,  0.9921568627450981, 0.011764705882352941     }, 0xf800ffff),
    _P(in, "lab(60% 125 -60)",     { 0.6,  0.9921568627450981, 0.26666666666666666     }, 0xff00ffff),
    _P(in, "lab(60% 125 0)",     { 0.6,  0.9921568627450981, 0.5019607843137255     }, 0xff0098ff),
    _P(in, "lab(60% 125 60)",     { 0.6,  0.9921568627450981, 0.7372549019607844     }, 0xff0038ff),
    _P(in, "lab(60% 125 125)",     { 0.6,  0.9921568627450981, 0.9921568627450981     }, 0xff0000ff),
    _P(in, "lab(80% -125 -125)",     { 0.8,  0.011764705882352941, 0.011764705882352941     }, 0x00feffff),
    _P(in, "lab(80% -125 -60)",     { 0.8,  0.011764705882352941, 0.26666666666666666     }, 0x00f9ffff),
    _P(in, "lab(80% -125 0)",     { 0.8,  0.011764705882352941, 0.5019607843137255     }, 0x00f6c2ff),
    _P(in, "lab(80% -125 60)",     { 0.8,  0.011764705882352941, 0.7372549019607844     }, 0x00f442ff),
    _P(in, "lab(80% -125 125)",     { 0.8,  0.011764705882352941, 0.9921568627450981     }, 0x00f400ff),
    _P(in, "lab(80% -60 -125)",     { 0.8,  0.26666666666666666, 0.011764705882352941     }, 0x00ecffff),
    _P(in, "lab(80% -60 -60)",     { 0.8,  0.26666666666666666, 0.26666666666666666     }, 0x00e6ffff),
    _P(in, "lab(80% -60 0)",     { 0.8,  0.26666666666666666, 0.5019607843137255     }, 0x00e3c4ff),
    _P(in, "lab(80% -60 60)",     { 0.8,  0.26666666666666666, 0.7372549019607844     }, 0x57e148ff),
    _P(in, "lab(80% -60 125)",     { 0.8,  0.26666666666666666, 0.9921568627450981     }, 0x6ce100ff),
    _P(in, "lab(80% 0 -125)",     { 0.8,  0.5019607843137255, 0.011764705882352941     }, 0x00d1ffff),
    _P(in, "lab(80% 0 -60)",     { 0.8,  0.5019607843137255, 0.26666666666666666     }, 0x80caffff),
    _P(in, "lab(80% 0 0)",     { 0.8,  0.5019607843137255, 0.5019607843137255     }, 0xc6c6c6ff),
    _P(in, "lab(80% 0 60)",     { 0.8,  0.5019607843137255, 0.7372549019607844     }, 0xdfc550ff), // 0xdfc450ff
    _P(in, "lab(80% 0 125)",     { 0.8,  0.5019607843137255, 0.9921568627450981     }, 0xe6c400ff),
    _P(in, "lab(80% 60 -125)",     { 0.8,  0.7372549019607844, 0.011764705882352941     }, 0xaca3ffff),
    _P(in, "lab(80% 60 -60)",     { 0.8,  0.7372549019607844, 0.26666666666666666     }, 0xff9affff),
    _P(in, "lab(80% 60 0)",     { 0.8,  0.7372549019607844, 0.5019607843137255     }, 0xff95c9ff),
    _P(in, "lab(80% 60 60)",     { 0.8,  0.7372549019607844, 0.7372549019607844     }, 0xff9259ff),
    _P(in, "lab(80% 60 125)",     { 0.8,  0.7372549019607844, 0.9921568627450981     }, 0xff9100ff),
    _P(in, "lab(80% 125 -125)",     { 0.8,  0.9921568627450981, 0.011764705882352941     }, 0xff00ffff),
    _P(in, "lab(80% 125 -60)",     { 0.8,  0.9921568627450981, 0.26666666666666666     }, 0xff00ffff),
    _P(in, "lab(80% 125 0)",     { 0.8,  0.9921568627450981, 0.5019607843137255     }, 0xff00ceff),
    _P(in, "lab(80% 125 60)",     { 0.8,  0.9921568627450981, 0.7372549019607844     }, 0xff0064ff),
    _P(in, "lab(80% 125 125)",     { 0.8,  0.9921568627450981, 0.9921568627450981     }, 0xff0000ff),
    _P(in, "lab(100% -125 -125)",     { 1.0,  0.011764705882352941, 0.011764705882352941     }, 0x00ffffff),
    _P(in, "lab(100% -125 -60)",     { 1.0,  0.011764705882352941, 0.26666666666666666     }, 0x00ffffff),
    _P(in, "lab(100% -125 0)",     { 1.0,  0.011764705882352941, 0.5019607843137255     }, 0x00fffaff),
    _P(in, "lab(100% -125 60)",     { 1.0,  0.011764705882352941, 0.7372549019607844     }, 0x00ff7bff),
    _P(in, "lab(100% -125 125)",     { 1.0,  0.011764705882352941, 0.9921568627450981     }, 0x00ff00ff),
    _P(in, "lab(100% -60 -125)",     { 1.0,  0.26666666666666666, 0.011764705882352941     }, 0x00ffffff),
    _P(in, "lab(100% -60 -60)",     { 1.0,  0.26666666666666666, 0.26666666666666666     }, 0x00ffffff),
    _P(in, "lab(100% -60 0)",     { 1.0,  0.26666666666666666, 0.5019607843137255     }, 0x36fffdff), // 0x36fffcff
    _P(in, "lab(100% -60 60)",     { 1.0,  0.26666666666666666, 0.7372549019607844     }, 0x96ff80ff),
    _P(in, "lab(100% -60 125)",     { 1.0,  0.26666666666666666, 0.9921568627450981     }, 0xaeff00ff), // 0xadff00ff
    _P(in, "lab(100% 0 -125)",     { 1.0,  0.5019607843137255, 0.011764705882352941     }, 0x00ffffff),
    _P(in, "lab(100% 0 -60)",     { 1.0,  0.5019607843137255, 0.26666666666666666     }, 0xbeffffff),
    _P(in, "lab(100% 0 0)",     { 1.0,  0.5019607843137255, 0.5019607843137255     }, 0xffffffff),
    _P(in, "lab(100% 0 60)",     { 1.0,  0.5019607843137255, 0.7372549019607844     }, 0xfffd86ff),
    _P(in, "lab(100% 0 125)",     { 1.0,  0.5019607843137255, 0.9921568627450981     }, 0xfffc00ff),
    _P(in, "lab(100% 60 -125)",     { 1.0,  0.7372549019607844, 0.011764705882352941     }, 0xf2dbffff),
    _P(in, "lab(100% 60 -60)",     { 1.0,  0.7372549019607844, 0.26666666666666666     }, 0xffd3ffff),
    _P(in, "lab(100% 60 0)",     { 1.0,  0.7372549019607844, 0.5019607843137255     }, 0xffceffff),
    _P(in, "lab(100% 60 60)",     { 1.0,  0.7372549019607844, 0.7372549019607844     }, 0xffcb8dff),
    _P(in, "lab(100% 60 125)",     { 1.0,  0.7372549019607844, 0.9921568627450981     }, 0xffca00ff),
    _P(in, "lab(100% 125 -125)",     { 1.0,  0.9921568627450981, 0.011764705882352941     }, 0xff79ffff),
    _P(in, "lab(100% 125 -60)",     { 1.0,  0.9921568627450981, 0.26666666666666666     }, 0xff66ffff),
    _P(in, "lab(100% 125 0)",     { 1.0,  0.9921568627450981, 0.5019607843137255     }, 0xff59ffff),
    _P(in, "lab(100% 125 60)",     { 1.0,  0.9921568627450981, 0.7372549019607844     }, 0xff5196ff),
    _P(in, "lab(100% 125 125)",     { 1.0,  0.9921568627450981, 0.9921568627450981     }, 0xff4d00ff)
));

INSTANTIATE_TEST_SUITE_P(ColorsSpacesLAB, badColorString, testing::Values(
    "lab", "lab(", "lab(100"
));

INSTANTIATE_TEST_SUITE_P(ColorsSpacesLAB, toString, testing::Values(
    _P(out, LAB, { 0.3,   0.2,   0.8         }, "lab(30 -77 76)"),
    _P(out, LAB, { 0.3,   0.8,   0.258       }, "lab(30 76 -62.21)"),
    _P(out, LAB, { 1.0,   0.5,   0.004       }, "lab(100 -0.5 -126.98)"),
    _P(out, LAB, { 0,     1,     0.2,   0.8  }, "lab(0 127 -77 / 80%)", true),
    _P(out, LAB, { 0,     1,     0.2,   0.8  }, "lab(0 127 -77)", false)
));

INSTANTIATE_TEST_SUITE_P(ColorsSpacesLAB, convertColorSpace, testing::Values(
    // No conversion
    _P(inb, LAB, {1.000, 0.400, 0.200}, LAB, {1.000, 0.400, 0.200})
));

INSTANTIATE_TEST_SUITE_P(ColorsSpacesLAB, normalize, testing::Values(
    _P(inb, LAB, { 0.5,   0.5,   0.5,   0.5  }, LAB, { 0.5,   0.5,   0.5,   0.5  }),
    _P(inb, LAB, { 1.2,   1.2,   1.2,   1.2  }, LAB, { 1.0,   1.0,   1.0,   1.0  }),
    _P(inb, LAB, {-0.2,  -0.2,  -0.2,  -0.2  }, LAB, { 0.0,   0.0,   0.0,   0.0  }),
    _P(inb, LAB, { 0.0,   0.0,   0.0,   0.0  }, LAB, { 0.0,   0.0,   0.0,   0.0  }),
    _P(inb, LAB, { 1.0,   1.0,   1.0,   1.0  }, LAB, { 1.0,   1.0,   1.0,   1.0  })
));
// clang-format on

TEST(ColorsSpacesLAB, randomConversion)
{
    // Full stack conversion
    EXPECT_TRUE(RandomPassthrough(LAB, RGB, 1000));
}

TEST(ColorsSpacesLAB, components)
{
    auto c = Manager::get().find(LAB)->getComponents();
    ASSERT_EQ(c.size(), 3);
    EXPECT_EQ(c[0].id, "l");
    EXPECT_EQ(c[1].id, "a");
    EXPECT_EQ(c[2].id, "b");
}

} // namespace

/*
  Local Variables:
  mode:c++
  c-file-style:"stroustrup"
  c-file-offsets:((innamespace . 0)(inline-open . 0))
  indent-tabs-mode:nil
  fill-column:99
  End:
*/
// vim: expandtab:shiftwidth=4:tabstop=8:softtabstop=4 :
